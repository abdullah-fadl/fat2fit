// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Ø§Ù„Ù…ÙˆØ¸ÙØ§Øª ÙˆØ§Ù„Ù…Ø¯Ø±Ø¨Ø§Øª
model User {
  id        String   @id @default(uuid())
  name      String
  email     String?  @unique
  phone     String?  @unique
  password  String
  role      String   @default("RECEPTION")
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  auditLogs  AuditLog[]
  accessLogs AccessLog[]
  checkIns   CheckIn[]
  invoices   Invoice[]

  @@map("users")
}

// Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©)
model Client {
  id               String    @id @default(uuid())
  membershipNumber String    @unique // Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©
  name             String
  phone            String    @unique
  idNumber         String?   @unique // Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
  email            String?
  dateOfBirth      DateTime?
  height           Float? // Ø§Ù„Ø·ÙˆÙ„ Ø¨Ø§Ù„Ø³Ù…
  weight           Float? // Ø§Ù„ÙˆØ²Ù† Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ
  healthStatus     String? // Ø­Ø§Ù„Ø© ØµØ­ÙŠØ©
  notes            String? // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  image            String? // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
  referredBy       String? // Ø¬Ù‡Ø© Ù…Ø¹Ø±ÙØ©
  qrCode           String?   @unique // QR Code Ù„Ù„Ø¹Ø¶ÙˆÙŠØ©
  barcode          String?   @unique // Barcode
  fingerprintId    String? // Ù…Ø¹Ø±Ù Ø§Ù„Ø¨ØµÙ…Ø© ÙÙŠ Ø¬Ù‡Ø§Ø² ZKTeco

  // Status
  status    String @default("ACTIVE")
  totalDebt Float  @default(0) // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscriptions Subscription[]
  payments      Payment[]
  invoices      Invoice[]
  checkIns      CheckIn[]
  clientNotes   ClientNote[]
  messages      Message[]

  @@map("clients")
}

// Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
model SubscriptionPackage {
  id          String  @id @default(uuid())
  name        String // Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠ)
  nameAr      String // Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
  type        String
  duration    Int // Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…
  price       Float // Ø§Ù„Ø³Ø¹Ø±
  visits      Int? // Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª (Ø¥Ù† ÙˆØ¬Ø¯)
  isVIP       Boolean @default(false)
  isActive    Boolean @default(true)
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscriptions Subscription[]

  @@map("subscription_packages")
}

// Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
model Subscription {
  id              String   @id @default(uuid())
  clientId        String
  packageId       String
  startDate       DateTime
  endDate         DateTime
  originalEndDate DateTime // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø£ØµÙ„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„ØªØ¬Ù…ÙŠØ¯

  status          String @default("ACTIVE")
  totalPrice      Float
  discountAmount  Float  @default(0) // Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…
  discountPercent Float? // Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…
  finalPrice      Float

  // ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  isFrozen        Boolean   @default(false)
  frozenReason    String?
  frozenStartDate DateTime?
  frozenEndDate   DateTime?
  frozenDays      Int       @default(0) // Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¬Ù…ÙŠØ¯

  // ØªØ¬Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
  autoRenew Boolean @default(false)

  // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  client   Client              @relation(fields: [clientId], references: [id], onDelete: Cascade)
  package  SubscriptionPackage @relation(fields: [packageId], references: [id])
  payments Payment[]
  invoices Invoice[]

  @@map("subscriptions")
}

// Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
model Payment {
  id             String  @id @default(uuid())
  clientId       String
  subscriptionId String?
  invoiceId      String?

  amount          Float
  paymentMethod   String
  paymentDate     DateTime @default(now())
  referenceNumber String? // Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹
  notes           String?

  // Ù„Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©
  isPartial       Boolean @default(false)
  remainingAmount Float? // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  client       Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  subscription Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)
  invoice      Invoice?      @relation(fields: [invoiceId], references: [id], onDelete: SetNull)

  @@map("payments")
}

// Ø§Ù„ÙÙˆØ§ØªÙŠØ±
model Invoice {
  id             String  @id @default(uuid())
  invoiceNumber  String  @unique // Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  clientId       String
  subscriptionId String?
  userId         String // Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø°ÙŠ Ø£ØµØ¯Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©

  subtotal       Float
  discountAmount Float @default(0)
  taxAmount      Float @default(0)
  total          Float

  status String @default("PENDING")

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  notes      String?
  couponCode String?
  subscriptionType String? // Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø§Ù„Ø¨Ø§Ù‚Ø©)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  paidAt    DateTime?

  // Relations
  client       Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  subscription Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)
  user         User          @relation(fields: [userId], references: [id])
  payments     Payment[]

  @@map("invoices")
}

// Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø­Ø¶ÙˆØ±
model CheckIn {
  id            String   @id @default(uuid())
  clientId      String
  userId        String? // Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø°ÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  checkInDate   DateTime @default(now())
  method        String // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (QR, Barcode, Phone, Fingerprint)
  fingerprintId String? // Ù…Ø¹Ø±Ù Ø§Ù„Ø¨ØµÙ…Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨ØµÙ…Ø©

  // Relations
  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user   User?  @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([clientId, checkInDate])
  @@map("check_ins")
}

// Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶
model Coupon {
  id          String  @id @default(uuid())
  code        String  @unique // ÙƒÙˆØ¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†
  name        String
  description String?

  discountType  String
  discountValue Float // Ù‚ÙŠÙ…Ø© Ø£Ùˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…
  minPurchase   Float? // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø´Ø±Ø§Ø¡
  maxDiscount   Float? // Ø£Ù‚ØµÙ‰ Ø®ØµÙ…

  validFrom   DateTime
  validUntil  DateTime
  maxUses     Int? // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª
  currentUses Int      @default(0)

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("coupons")
}

// Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„Ø©
model ClientNote {
  id        String   @id @default(uuid())
  clientId  String
  note      String
  createdBy String? // Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù
  createdAt DateTime @default(now())

  // Relations
  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("client_notes")
}

// Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ (Audit Log)
model AuditLog {
  id          String  @id @default(uuid())
  userId      String
  action      String // Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (create, update, delete)
  entityType  String // Ù†ÙˆØ¹ Ø§Ù„ÙƒÙŠØ§Ù† (Client, Subscription, etc.)
  entityId    String // Ù…Ø¹Ø±Ù Ø§Ù„ÙƒÙŠØ§Ù†
  oldValue    String? // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (JSON)
  newValue    String? // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (JSON)
  description String?
  ipAddress   String?

  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@map("audit_logs")
}

// Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨ØµÙ…Ø© ZKTeco
model ZKDevice {
  id          String    @id @default(uuid())
  name        String
  ip          String
  port        Int       @default(4370)
  password    String?
  description String?
  isActive    Boolean   @default(true)
  lastSync    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("zk_devices")
}

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Odoo
model OdooSettings {
  id       String  @id @default(uuid())
  url      String
  database String
  username String
  apiKey   String // API Key Ù„Ù„Ù…ØµØ§Ø¯Ù‚Ø©
  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([url, database])
  @@map("odoo_settings")
}

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©
model SecuritySettings {
  id String @id @default(uuid())

  // Ø§Ù„ØªØ´ÙÙŠØ±
  encryptionEnabled   Boolean @default(true)
  encryptPhoneNumbers Boolean @default(true)
  encryptNames        Boolean @default(false)
  encryptEmails       Boolean @default(false)

  // Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
  autoBackupEnabled   Boolean @default(true)
  backupIntervalHours Int     @default(24) // ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©
  backupRetentionDays Int     @default(30) // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€ 30 ÙŠÙˆÙ…

  // Ø§Ù„Ø£Ù…Ø§Ù†
  requireStrongPassword Boolean @default(true)
  sessionTimeoutMinutes Int     @default(60) // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø¹Ø¯ 60 Ø¯Ù‚ÙŠÙ‚Ø©
  maxLoginAttempts      Int     @default(5) // Ø£Ù‚ØµÙ‰ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¯Ø®ÙˆÙ„

  // Ø§Ù„Ø®ØµÙˆØµÙŠØ©
  allowDataExport       Boolean @default(false) // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  anonymizeLogs         Boolean @default(true) // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© ÙÙŠ Ø§Ù„Ù€ logs
  auditLogRetentionDays Int     @default(365) // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø³Ø¬Ù„ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ù„Ù€ 365 ÙŠÙˆÙ…

  // GDPR/Privacy
  gdprCompliant     Boolean @default(true)
  dataRetentionDays Int? // Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (null = Ø¥Ù„Ù‰ Ù…Ø§ Ù„Ø§ Ù†Ù‡Ø§ÙŠØ©)
  rightToDelete     Boolean @default(true) // Ø­Ù‚ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("security_settings")
}

// Ø³Ø¬Ù„ Ø§Ù„ÙˆØµÙˆÙ„ (Access Log)
model AccessLog {
  id           String  @id @default(uuid())
  userId       String?
  ipAddress    String
  userAgent    String?
  action       String // LOGIN, LOGOUT, VIEW_DATA, EXPORT_DATA, etc.
  resource     String? // Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ±Ø¯ (Client, Subscription, etc.)
  resourceId   String? // Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ±Ø¯
  success      Boolean @default(true)
  errorMessage String?

  createdAt DateTime @default(now())

  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId, createdAt])
  @@index([ipAddress])
  @@index([action, createdAt])
  @@map("access_logs")
}

// Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„
model Message {
  id         String  @id @default(uuid())
  clientId   String?
  campaignId String?

  type         String // SMS, WHATSAPP, EMAIL
  channel      String // SMS, WHATSAPP, EMAIL
  content      String // Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
  status       String  @default("PENDING") // PENDING, SENT, FAILED, DELIVERED
  errorMessage String?

  phoneNumber   String? // Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªÙ„Ù…
  recipientName String?

  sentAt      DateTime?
  deliveredAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  client   Client?   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  campaign Campaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)

  @@index([clientId])
  @@index([campaignId])
  @@index([status])
  @@map("messages")
}

// Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©
model Campaign {
  id          String  @id @default(uuid())
  name        String
  description String?

  type    String // PROMOTIONAL, REMINDER, WELCOME, EXPIRY_REMINDER
  channel String // SMS, WHATSAPP, EMAIL, ALL
  content String // Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ±Ø§Øª Ù…Ø«Ù„ {name}, {membershipNumber})

  targetType String // ALL_CLIENTS, ACTIVE_SUBSCRIPTIONS, EXPIRING_SUBSCRIPTIONS, SPECIFIC_CLIENTS
  filters    String? // JSON filters (package type, subscription status, etc.)

  status      String    @default("DRAFT") // DRAFT, SCHEDULED, RUNNING, COMPLETED, CANCELLED
  scheduledAt DateTime?
  startedAt   DateTime?
  completedAt DateTime?

  totalRecipients Int @default(0)
  sentCount       Int @default(0)
  deliveredCount  Int @default(0)
  failedCount     Int @default(0)

  createdBy String // User ID
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  messages Message[]

  @@map("campaigns")
}

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
model MessageSettings {
  id String @id @default(uuid())

  // SMS Settings
  smsProvider  String? // TWILIO, CUSTOM_API, etc.
  smsApiKey    String?
  smsApiSecret String?
  smsSenderId  String?

  // WhatsApp Settings
  whatsappProvider    String? // TWILIO, META, CUSTOM_API
  whatsappApiKey      String?
  whatsappApiSecret   String?
  whatsappPhoneNumber String?

  // ØªØ°ÙƒÙŠØ±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
  expiryReminderEnabled Boolean @default(true)
  expiryReminderDays    String  @default("7,3,1") // Ø£ÙŠØ§Ù… Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
  expiryReminderMessage String  @default("Ø¹Ø²ÙŠØ²ØªÙŠ {name}ØŒ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø³ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ {days} ÙŠÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹.")

  welcomeMessageEnabled Boolean @default(true)
  welcomeMessage        String  @default("Ù…Ø±Ø­Ø¨Ø§Ù‹ {name}! Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Fat2Fit ğŸ‰")

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("message_settings")
}
