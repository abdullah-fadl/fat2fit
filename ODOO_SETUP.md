# دليل ربط النظام مع Odoo المحاسبي

## نظرة عامة

تم إضافة نظام متكامل لربط Fat2Fit مع Odoo المحاسبي لمزامنة:
- **العملاء (Partners)**: مزامنة بيانات العملاء
- **الفواتير (Invoices)**: إرسال الفواتير تلقائياً إلى Odoo
- **المدفوعات (Payments)**: مزامنة المدفوعات مع Odoo

---

## متطلبات Odoo

1. **نسخة Odoo**: 14.0 أو أحدث
2. **الوصول**: حساب مستخدم لديه صلاحيات:
   - إنشاء/تعديل العملاء (res.partner)
   - إنشاء/تأكيد الفواتير (account.move)
   - إنشاء/تأكيد المدفوعات (account.payment)
3. **API Access**: يجب تفعيل XML-RPC في Odoo

---

## خطوات الإعداد

### 1. تفعيل XML-RPC في Odoo

في ملف إعدادات Odoo (عادة في `odoo.conf` أو إعدادات النظام):
```ini
[options]
xmlrpc = True
xmlrpc_interface = 0.0.0.0
xmlrpc_port = 8069
```

### 2. إعداد API Key في Odoo

1. افتح Odoo وانتقل إلى **Settings**
2. اذهب إلى **Users & Companies > Users**
3. افتح حساب المستخدم الذي ستستخدمه
4. في قسم **Preferences > API Keys**، أنشئ API Key جديد
5. انسخ API Key (أو استخدم كلمة المرور مباشرة)

### 3. تكوين الإعدادات في Fat2Fit

1. افتح النظام وانتقل إلى **إعدادات Odoo**
2. أدخل البيانات التالية:
   - **عنوان Odoo**: مثل `https://odoo.example.com` أو `http://localhost:8069`
   - **قاعدة البيانات**: اسم قاعدة البيانات في Odoo
   - **اسم المستخدم**: اسم المستخدم في Odoo
   - **API Key**: API Key أو كلمة المرور
3. فعّل **تفعيل المزامنة مع Odoo**
4. اختر أنواع المزامنة المطلوبة:
   - ✅ مزامنة العملاء
   - ✅ مزامنة الفواتير
   - ✅ مزامنة المدفوعات
5. اضغط **حفظ الإعدادات**
6. اضغط **اختبار الاتصال** للتحقق

---

## كيفية الاستخدام

### المزامنة التلقائية

عند تفعيل المزامنة، سيتم إرسال البيانات تلقائياً إلى Odoo عند:
- **إنشاء فاتورة جديدة**: يتم إنشاء فاتورة في Odoo تلقائياً
- **تسجيل دفعة**: يتم إنشاء دفعة وربطها بالفاتورة في Odoo

### المزامنة اليدوية

يمكنك مزامنة البيانات يدوياً من صفحة **إعدادات Odoo**:
- **مزامنة الكل**: مزامنة جميع البيانات (عملاء، فواتير، مدفوعات)
- **مزامنة العملاء فقط**: مزامنة بيانات العملاء
- **مزامنة الفواتير فقط**: مزامنة الفواتير
- **مزامنة المدفوعات فقط**: مزامنة المدفوعات

---

## بيانات المزامنة

### العملاء (Partners)
- الاسم (name)
- البريد الإلكتروني (email)
- رقم الجوال (phone/mobile)
- ملاحظات (comment)

### الفواتير (Invoices)
- العميل (partner_id)
- تاريخ الفاتورة (invoice_date)
- العناصر (invoice_line_ids):
  - اسم الباقة/الخدمة
  - الكمية (1)
  - السعر (subtotal)
- المبلغ الإجمالي (amount_total)
- الضريبة (amount_tax)
- الخصم (discountAmount)

### المدفوعات (Payments)
- العميل (partner_id)
- المبلغ (amount)
- تاريخ الدفع (payment_date)
- رقم المرجع (ref)
- ربط مع الفاتورة (invoice_ids)

---

## استكشاف الأخطاء

### خطأ: "فشل الاتصال مع Odoo"
**الحلول:**
1. تأكد من صحة عنوان Odoo (URL)
2. تأكد من أن XML-RPC مفعل في Odoo
3. تحقق من جدار الحماية (Firewall)
4. جرب الاتصال من المتصفح: `http://your-odoo-url:8069`

### خطأ: "فشل تسجيل الدخول"
**الحلول:**
1. تحقق من صحة اسم المستخدم وكلمة المرور/API Key
2. تأكد من أن المستخدم لديه الصلاحيات المطلوبة
3. تحقق من اسم قاعدة البيانات

### خطأ: "لا يمكن إنشاء فاتورة"
**الحلول:**
1. تأكد من وجود العميل في Odoo أولاً
2. تحقق من صلاحيات المستخدم لإنشاء الفواتير
3. تأكد من إعداد الحسابات المحاسبية في Odoo

---

## ملاحظات مهمة

1. **الأمان**: احفظ API Key بشكل آمن ولا تشاركه
2. **النسخ الاحتياطي**: احرص على عمل نسخة احتياطية قبل المزامنة الكبيرة
3. **الاختبار**: جرب المزامنة على بيانات تجريبية أولاً
4. **التأخير**: قد تستغرق المزامنة وقتاً حسب حجم البيانات

---

## دعم فني

إذا واجهت مشاكل:
1. راجع سجلات الأخطاء في Odoo
2. راجع سجلات النظام في Fat2Fit
3. تحقق من حالة المزامنة في صفحة الإعدادات

---

## تحديثات مستقبلية

- مزامنة منتجات الباقات كـ Products في Odoo
- إعداد حسابات محاسبية مخصصة
- مزامنة ثنائية الاتجاه (من Odoo إلى Fat2Fit)
- تقارير متقدمة للمزامنة







